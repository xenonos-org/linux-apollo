From 419a77f4a550de6b1913c2c99e38126479251737 Mon Sep 17 00:00:00 2001
From: Rithvik Ballari <nexus-x@tuta.io>
Date: Fri, 14 Nov 2025 20:12:34 +0530
Subject: [PATCH 3/9] Ignore ICMP echoes

Signed-off-by: Rithvik Ballari <nexus-x@tuta.io>
---
 net/ipv4/icmp.c     | 2 +-
 net/ipv6/af_inet6.c | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/net/ipv4/icmp.c b/net/ipv4/icmp.c
index 508b23204..202ff5ae4 100644
--- a/net/ipv4/icmp.c
+++ b/net/ipv4/icmp.c
@@ -1476,7 +1476,7 @@ static const struct icmp_control icmp_pointers[NR_ICMP_TYPES + 1] = {
 static int __net_init icmp_sk_init(struct net *net)
 {
 	/* Control parameters for ECHO replies. */
-	net->ipv4.sysctl_icmp_echo_ignore_all = 0;
+	net->ipv4.sysctl_icmp_echo_ignore_all = 1;
 	net->ipv4.sysctl_icmp_echo_enable_probe = 0;
 	net->ipv4.sysctl_icmp_echo_ignore_broadcasts = 1;
 
diff --git a/net/ipv6/af_inet6.c b/net/ipv6/af_inet6.c
index f60ec8b0f..e11588d0e 100644
--- a/net/ipv6/af_inet6.c
+++ b/net/ipv6/af_inet6.c
@@ -956,7 +956,7 @@ static int __net_init inet6_net_init(struct net *net)
 
 	net->ipv6.sysctl.bindv6only = 0;
 	net->ipv6.sysctl.icmpv6_time = 1*HZ;
-	net->ipv6.sysctl.icmpv6_echo_ignore_all = 0;
+	net->ipv6.sysctl.icmpv6_echo_ignore_all = 1;
 	net->ipv6.sysctl.icmpv6_echo_ignore_multicast = 0;
 	net->ipv6.sysctl.icmpv6_echo_ignore_anycast = 0;
 	net->ipv6.sysctl.icmpv6_error_anycast_as_unicast = 0;
-- 
2.51.2

