From bced7b7dd61f8f59c97b2ff7f63f15e341ffce3d Mon Sep 17 00:00:00 2001
From: Ariadne Conill <ariadne@ariadne.space>
Date: Sun, 21 Jul 2024 15:46:41 -0700
Subject: [PATCH 16/29] security: add openpax EMUTRAMP config option

Signed-off-by: Ariadne Conill <ariadne@ariadne.space>
---
 security/Kconfig.openpax | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/security/Kconfig.openpax b/security/Kconfig.openpax
index 7a07386e116a..d8ee4bc570b6 100644
--- a/security/Kconfig.openpax
+++ b/security/Kconfig.openpax
@@ -55,4 +55,21 @@ config OPENPAX_MPROTECT
 	  JIT compilation appropriately so the W^X enforcement is
 	  disabled for them.
 
+config OPENPAX_EMUTRAMP
+	bool "Emulate stack and heap trampolines"
+	depends on OPENPAX
+	default y
+	help
+	  Enabling this option allows programs to depend on common
+	  types of stack and heap trampolines (such as the ones
+	  generated by GCC and libffi) to continue working despite
+	  the stack and heap being non-executable memory.
+	
+	  This option works by intercepting the page faults caused
+	  by executing code in non-executable memory and emulating
+	  the side effects that would have happened from executing
+	  the trampoline.
+	
+	  Most likely, you should say 'y' here.
+
 endmenu
-- 
2.51.2

