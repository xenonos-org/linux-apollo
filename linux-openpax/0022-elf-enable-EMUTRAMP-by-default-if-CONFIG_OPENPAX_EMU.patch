From d6efdf28eafa1c36e434c8b0531d840d6801e913 Mon Sep 17 00:00:00 2001
From: Ariadne Conill <ariadne@ariadne.space>
Date: Sun, 21 Jul 2024 18:42:57 -0700
Subject: [PATCH 22/29] elf: enable EMUTRAMP by default if
 CONFIG_OPENPAX_EMUTRAMP_DEFAULT is enabled

Signed-off-by: Ariadne Conill <ariadne@ariadne.space>
---
 fs/binfmt_elf.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/fs/binfmt_elf.c b/fs/binfmt_elf.c
index 0edac32e66c5..455c857df3c9 100644
--- a/fs/binfmt_elf.c
+++ b/fs/binfmt_elf.c
@@ -869,6 +869,10 @@ static int openpax_set_flags(struct file * const file)
 		set_bit(PAXF_MPROTECT, &current->mm->pax_flags);
 	}
 
+#ifdef CONFIG_OPENPAX_EMUTRAMP_DEFAULT
+	set_bit(PAXF_EMUTRAMP, &current->mm->pax_flags);
+#endif
+
 #ifdef CONFIG_OPENPAX_XATTR_PAX_FLAGS
 	error = openpax_parse_xattr_flags(file);
 	if (error != -ENOENT)
-- 
2.51.2

